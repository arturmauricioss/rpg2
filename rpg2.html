<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RPG em Javascript</title>
  <style>
      *, html, body{
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      body {
      font-family: Arial, sans-serif;
      background-image: url("media/img/back1.jpeg");
      background-size: cover;
      background-position: center center;
      background-attachment: fixed;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
  }

      .container {
        width: 90%;
        max-width: 600px;
        background-color: #222d;
        padding: 20px;
        margin: auto 1%;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
      }

      h1 {
        text-align: center;
        margin-bottom: 2px;
      }

      form {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .form-section {
        flex: 1;
    min-width: 150px;
    margin: 10px 0;
}
      .form-section-attrib {
        flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
}

.form-section label,
.form-section select,
.form-section input[type="number"],
.form-section input[type="text"],
.form-section button {
    margin-bottom: 10px;
    font-size: 16px;
    width: 100%;
}

.attributes {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.attribute {
    width: calc(30%); /* Ajusta a largura dos atributos com um espaço de 10px entre eles */
    display: flex;
    flex-direction: column;
}

.stats-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    border: 1px solid #1fab30aa;
    border-radius: 20px;
    padding: 10px;
    margin-top: 20px;
}

      .stats {
        flex: 1;
        text-align: center;
      }

      .bar {
        height: 20px;
        border-radius: 10px;
        margin-top: 5px;
        position: relative;
        overflow: hidden;
      }
      .barxp {
        background-color: #26a69a;
      }
      .barhp {
        background-color: #ff4c4c;
      }
      .bar .progress {
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        transition: width 0.3s;
      }

      .hp .progress {
        background-color:#4caf50;
      }

      .xp .progress {
        background-color:#ffa726;
      }
      

      .bar .text {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        line-height: 20px;
        color: #fff;
        text-shadow: 2px 2px 4px #000000;
        white-space: nowrap; /* Impede a quebra de linha */
    overflow: hidden; /* Garante que o texto não saia da barra */
    text-overflow: ellipsis; /* Adiciona reticências se o texto for muito longo */
 
      }

      .gold {
        text-align: center;
        margin-top: 5px;
        font-size: 18px;
      }

      .gold span {
        color: #ffd700;
      }

      .log-container {
        margin-top: 20px;
      }

      .log-container h3 {
        text-align: center;
        margin-bottom: 10px;
      }

      .encounter-log {
    background-color: #444;
    padding: 10px;
    border-radius: 5px;
    max-height: 120px; /* Altura máxima da caixa de log */
    overflow-y: auto; /* Habilita a rolagem vertical */
    display: flex;
    flex-direction: column; /* Apenas display flex sem reversão da direção */
  }


      .actions {
        display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;;
      }

      .actions button {
    flex: 1;
    padding: 10px;
    background-color: #444;
    color: #fff;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
}

.actions button:hover {
    background-color: #666;
}

#versao2 {
    color: aqua;
    text-decoration: none;
}

#versao2:visited {
    color: green;
}

/* Media Queries para Responsividade */

@media (max-width: 600px) {
    .form-section{
    
        width: 100%; /* Faz com que os elementos ocupem toda a largura disponível */
        min-width: auto; /* Remove a largura mínima */
    }
    .attribute {
      width:30%;
    }

    .stats-container {
        flex-direction: column;
    }

    .stats {
        margin-bottom: 10px;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 10px;
    }

    .form-section,
    .attribute {
        font-size: 14px; /* Ajusta o tamanho da fonte para telas menores */
    }

    .actions button {
        padding: 8px;
        font-size: 14px;
    }
}
@media(max-width:220px){
  .attribute{
    min-width: 30px;
  }
}

.attribute label {
    display: block;
    font-size: 16px;
}

/* Estilo padrão para rótulos dos atributos */
.attribute[data-attribute="strength"] label::after {
    content: "Força";
}

.attribute[data-attribute="constitution"] label::after {
    content: "Constituição";
}

.attribute[data-attribute="dexterity"] label::after {
    content: "Destreza";
}

.attribute[data-attribute="intelligence"] label::after {
    content: "Inteligência";
}

.attribute[data-attribute="wisdom"] label::after {
    content: "Sabedoria";
}

.attribute[data-attribute="charisma"] label::after {
    content: "Carisma";
}

/* Media Query para telas menores que 768px */
@media (max-width: 768px) {
    .attribute label::after {
        display: inline;
        content: attr(data-abbreviation); /* Usa o atributo data-abbreviation para o conteúdo reduzido */
        font-size: 14px; /* Ajusta o tamanho da fonte, se necessário */
    }

    .attribute[data-attribute="strength"] label::after {
        content: "FOR";
    }

    .attribute[data-attribute="constitution"] label::after {
        content: "CON";
    }

    .attribute[data-attribute="dexterity"] label::after {
        content: "DES";
    }

    .attribute[data-attribute="intelligence"] label::after {
        content: "INT";
    }

    .attribute[data-attribute="wisdom"] label::after {
        content: "SAB";
    }

    .attribute[data-attribute="charisma"] label::after {
        content: "CAR";
    }

    .attribute label {
        font-size: 14px; /* Ajusta o tamanho da fonte para telas menores */
    }
}
  </style>
</head>
<body>
  <div class="container">
    <h1>Avallon RPG</h1>
    
    <form id="characterForm">
      <div class="form-section">
        <label for="name" title="Um nome aleatório será gerado se vazio">Nome:</label>
        <input type="text" id="name" name="name" required title="Um nome aleatório será gerado se vazio">

        <label for="race" title="Raça padrão: Humano">Raça:</label>
        <select id="race" name="race">
          <option value="humano">Humano</option>
          <option value="elfo">Elfo</option>
        </select>
        
        <label for="class" title="Classe padrão: Bárbaro">Classe:</label>
        <select id="class" name="class">
          <option value="barbaro" title="For +1">Bárbaro</option>
          <option value="bardo" title="Car +1">Bardo</option>
          <option value="bruxo" title="Con +1">Bruxo</option>
          <option value="clerigo" title="Int +1">Clérigo</option>
          <option value="druida" title="Sab +1">Druida</option>
          <option value="feiticeiro" title="Car +1">Feiticeiro</option>
          <option value="guerreiro" title="For +1">Guerreiro</option>
          <option value="ladino" title="Des +1">Ladino</option>
          <option value="monge" title="Sab +1">Monge</option>
          <option value="paladino" title="Con +1">Paladino</option>
          <option value="patrulheiro" title="Des +1">Patrulheiro</option>
          <option value="mago" title="Int +1">Mago</option>
        </select>
      </div>

      <div class="form-section form-section-attrib attributes">
        <div class="attribute" data-attribute="strength" title="Armadura e Redução de dano">
          <label for="strength"></label>
          <input type="number" id="strength" name="strength" min="1" max="20" readonly required>
      </div>
      
      <div class="attribute" data-attribute="constitution" title="HP inicial, por level, e regeneração">
          <label for="constitution"></label>
          <input type="number" id="constitution" name="constitution" min="1" max="20" readonly required>
      </div>
      
      <div class="attribute" data-attribute="dexterity" title="Esquiva, Ataque furtivo e Roubo">
          <label for="dexterity"></label>
          <input type="number" id="dexterity" name="dexterity" min="1" max="20" readonly required>
      </div>
      
      <div class="attribute" data-attribute="intelligence" title="O Personagem está aprendendo, xp passivo">
          <label for="intelligence"></label>
          <input type="number" id="intelligence" name="intelligence" min="1" max="20" readonly required>
      </div>
      
      <div class="attribute" data-attribute="wisdom" title="Amplifique sua cura">
          <label for="wisdom"></label>
          <input type="number" id="wisdom" name="wisdom" min="1" max="20" readonly required>
      </div>
      
      <div class="attribute" data-attribute="charisma" title="Ganancioso, mais ouro e mais muquirana">
          <label for="charisma"></label>
          <input type="number" id="charisma" name="charisma" min="1" max="20" readonly required>
      </div>
      </div>
    </form>

    <div class="stats-container">
      <div class="stats">
        <h3>Level</h3>
        <div id="levelText">1</div>
      </div>
      <div class="stats">
        <h3>XP</h3>
        <div class="bar xp barxp">
          <div class="progress" id="xpBar" style="width: 0%;"></div>
          <div class="text" id="xpText">0 / 100</div>
        </div>
      </div>
      <div class="stats">
        <h3 title="O descanso regenera o HP">HP</h3>
        <div class="bar hp barhp" title="">
          <div class="progress" id="hpBar" style="width: 100%;"></div>
          <div class="text" id="hpText">100 / 100</div>
        </div>
      </div>

      <div class="stats">
        <h3>Ouro</h3>
        <div class="gold" id="goldText"><span>0</span></div>
      </div>
    </div>
    <div class="actions">
        <button type="button" id="startButton" onclick="startOrRestartGame()" title="Comece Aqui!">Começar Jogo</button>
        <button type="button" onclick="farmMonsters()" title="Entrar em Masmorras">Farmar</button>
        <button type="button" onclick="usePotion()" title="A melhor refeição de Avallon">Comida - 70 Ouro</button>
        <button type="button" onclick="useTaberna()" title="Consiga ajuda">Evento - 500 Ouro</button>
      </div>
    <div class="log-container">
      <h3>Encontros</h3>
      <div class="encounter-log" id="encounterLog"></div>
    </div>

    <div style="text-align: center; padding-top: 10px;"><a id="versao2" href="../_rpg/rpg.html" target="_blank" color="white">The Legend of Avallon em breve</a></div>
 <div>
  <p>Proximas atualizações</p>
  <hr>
  <p>recalcular e equilibriar os atributos e seus ganhos em suas formulas
    <br>
    nivelamento de ganho de xp e gold por cada monstro
    <br>
    nivelamento dos monstros
    <br>
    imagem contendo rosto da raça escolhida
    <br>
    inserir genero alterando imagem da raça de acordo com o genero
    <br>
    bonificação de raça
    <br>
    adicionar alinhamento como tendencia ou carater e conceder efeito
    <br>
    adicionar origem do char incluindo a opção random dos antepassados e conceder efeito
    <br>
    adicionar visualizaçao dos dados rolados com circulos, onde os 3 maiores ficam verde e o menor fica vermelho
    <br>
    tela de encontros de monstros com imagem
    <br>
    barras de hp dos monstros 
    <br>
    batalhs por rounds calculados por força e hp dos monstros
    <br>
    dano controlados por atributo força da classe
    <br>
    velocidade de ataque controlada por destreza 
    <br>
    velocidade de ataque mostra a quantidade de ataques por segundo
    <br>
    inserir velocidade de ataque para monstros
    <br>
    adicionar efeitos de controle, veneno
    <br>
    adicionar mana
    <br>
    adicionar magias
    <br>
    adicionar buffs
    <br>
    adicionar painel de itens
    <br>
    adicionar botao de comprar itens
    <br>
    adicionar botao de comprar buffs
    <br>
    adicionar taberna para contratar mercenários 
    <br>
    adicionar efeitos de quebra de armadura, critico, e penetração de armadura
    <br>
    conceder separação entre ataque fisico e magico defesa fisica e magica
    <br>
    balancear habilidades e tempo de recarga
    <br>
    adicionar interface espelhada entre monstros e heroi
    <br>
    adicionar interface 2d baseada em pontos, cada monstro sendo um ponto ao inves do botao farmar basta mover seu ponto e encostar no outro ponto.
    <br>
    criar visual grafico onde os montros são encontrados em área de "mato"
    <br>
    criar visual grafico onde o personagem tem sua visualização 2d de todas as posiçoes e animaçõ de movimento.
    <br>
    criar um botao de configuração do jogo
    <br>
    nãs configurações permetir que o jogador escolha entre controlar o personagem em rotas 2d ou com movimentos diagonais também.
    <br>
    nas configurações permitir controle de volume do jogo
    <br>
    nas configurações permitir a tradução do jogo para alguns idiomas
    <br>
    nas configurações permitir modelo de controle para touch
    <br>
    nas configuraçõe permitir modelo de controle fisico
    <br>
    adicionar atalhos para controles mas rápidos e exibir a posibilidade de edição nas configurações
    <br>
    consolidar controle completo com apenas uma entrada se necessário, teclado, mouse, touch e joystick
    <br>
    tutorial para conectar joystick ao jogo
    <br>
    adicionar pontos de teleporte de mapa para trocar de vila
    <br>
    adicionar pontos de teleporte para tabernas, hospitais, ferreiro, hotel e outros
    <br>
    adicionar boss por mapa, que impede o avanço do player
    <br>
    o jogo irá salvar seus atributos e gold em cada level em uma array.
    <br>
    caso a morte aconteça, respawn será ativido. portanto respawn será adicionado.
    <br>
    a punição pela morte será a perda de 1 level a cada 5 arredondado para baixo, buscar os atributos voltar para o level carregando da array as informações do level especifico, os leveis seguintes deverão ser apagados da array.
    <br>
    adicionar drop de itens e taxa de drop baseada em atributo
    <br>
    adicionar barra de stamina, fome, sono, sede.
    <br>
    adicionar talentos
    <br>
    controle com api do chatgpt de narração de historia
  </p>
 </div>
  </div>

  <audio id="levelUpSound">
    <source src="media/audio/lvlup.mp3" type="audio/mpeg">
    Seu navegador não suporta áudio HTML5.
  </audio>
  <audio id="potionSound">
    <source src="media/audio/potion.mp3" type="audio/mpeg">
    Seu navegador não suporta áudio HTML5.
  </audio>
  <audio id="deadSound">
    <source src="media/audio/dead.mp3" type="audio/mpeg">
    Seu navegador não suporta áudio HTML5.
  </audio>
<script>
  // Variáveis do jogador
  let player = {
    name: '',
    race: '',
    class: '',
    level: 1,
    xp: 0,
    maxHp: 0,
    currentHp: 0,
    strength: 0,
    constitution: 0,
    dexterity: 0,
    intelligence: 0,
    wisdom: 0,
    charisma: 0,
    gold: 0,
    xpNeeded: 100,
    monstersPerLevel: [],
    potionCost: 70,
    tabernaCost: 500,
    diceRolled: false
  };

  ////////nomes aleatorios caso o player não escolha um nome.
  const nomesAleatorios = [
'Frodo', 'Aragorn', 'Gandalf', 'Legolas', 'Gimli', 'Samwise Gamgi', 'Boromir', 'Merry', 'Pippin', 'Saruman', 'Sauron', 'Elrond', 'Galadriel', 'Bilbo Bolseiro', 'Thranduil', 'Gollum', 'Éomer', 'Éowyn', 'Faramir', 'Radagast', 'Athena', 'Icarus', 'Atlas', 'Afrodite', 'Natus Vincere', 'Morfeu', 'Arthur Pendragon', 'Uther', "D'Artagnan", 'Armstrong', 'Celina', 'Aya', 'Pandora', 'Isis', 'Argos', 'Luthien', 'Yavana', 'Elianor', 'Agatha', 'Mira', 'Noele', 'Kael'
        
];
// Variável para controlar o estado do jogo
let gameStarted = false;
let startregenerationTimer = null; // Armazena o timer de regeneração
let startxpGainTimer = null; // Armazena o timer de ganho de XP

// Função para iniciar ou reiniciar o jogo
function startOrRestartGame() {
  
    if (gameStarted) {
        // Reiniciar o jogo
        clearTimers(); 
        startGame();
        document.getElementById('startButton').textContent = 'Reiniciar Jogo';
        
    } else {
        // Iniciar o jogo pela primeira vez
        startGame(); // Chama a função startGame para iniciar o jogo
        gameStarted = true; // Define que o jogo foi iniciado
        // Altera o texto do botão para "Reiniciar Jogo"
        document.getElementById('startButton').textContent = 'Reiniciar Jogo';
    }
}
  ///função para iniciar o jogo
  function startGame() {

    const formData = new FormData(document.getElementById('characterForm'));
    let nomeInput = formData.get('name').trim(); // Obter o nome do formulário e remover espaços em branco

    // Verificar se o nome está vazio ou não preenchido
    if (nomeInput === '') {
        // Escolher um nome aleatório da lista
        const nomeAleatorioIndex = Math.floor(Math.random() * nomesAleatorios.length);
        player.name = nomesAleatorios[nomeAleatorioIndex];
        nomeInput = player.name; // Atualiza nomeInput com o nome aleatório escolhido
    } else {
        player.name = nomeInput;
    }

    // Atualiza o valor do campo de texto no formulário com o nome escolhido
    document.getElementById('name').value = nomeInput;

    player.race = formData.get('race');
    player.class = formData.get('class');
    player.strength = getRandomAbilityScore();
    player.constitution = getRandomAbilityScore();
    player.dexterity = getRandomAbilityScore();
    player.intelligence = getRandomAbilityScore();
    player.wisdom = getRandomAbilityScore();
    player.charisma = getRandomAbilityScore();
    player.maxHp = getInitialMaxHp();
    player.currentHp = player.maxHp;
    player.gold = 0;
    player.xp = 0;
    player.level = 1;
    player.xpNeeded = 100;
    player.potionCost = calculatePotionCost(); // Calcula o custo da Comida baseado na Carisma
    player.tabernaCost = 500;

    logMessage(`Jogo iniciado! Boa sorte, ${player.name}!`);
    logMessage('4 dados de 6 lados rolados por atributo');
    logMessage('Soma dos 3 maiores dados efetuada');
    updateAttributes();
    updateGameInfo();
    updatePotionButton(); // Atualiza o texto do botão de Comida

    // Iniciar o temporizador para regenerar HP com base na sabedoria
    startRegenerationTimer();
    startdebufftimer();
    // Iniciar o temporizador para ganhar XP passivamente com base na inteligência
    startXpGainTimer();
  }

///////////////////////////Constituição HP total, Hp por Level, Quantidade de regen de HP.

  function getInitialMaxHp() {
  // Calcular o HP baseado na Constituição
  let baseHp = Math.floor((player.constitution - 10) / 2) + 80;

  // Adicionar um valor aleatório entre 1 e 8
  let randomBonus = Math.floor(Math.random() * 8) + 1;

  // Retornar o HP inicial total
  return baseHp + randomBonus;
}

///////////////////////////Carisma
function calculatePotionCost() {
    return Math.max(20, 70 - player.charisma); // Custo mínimo de 20
}

///////////////////////////Sabedoria tempo para regenerar.
function clearTimers() {
    if (startRegenerationTimer !== null) {
        console.log('Limpando o timer de regeneração');
        clearInterval(startRegenerationTimer);
        startRegenerationTimer = null;
    }

    if (startXpGainTimer !== null) {
        console.log('Limpando o timer de XP');
        clearInterval(startXpGainTimer);
        startXpGainTimer = null;
    }
}
// Função para iniciar o temporizador de regeneração de HP
function startRegenerationTimer() {
  
    // Calcula o intervalo de regeneração baseado na sabedoria do jogador
    const regenerationInterval = 200000 / player.wisdom; // Intervalo em milissegundos
    setInterval(regenerateHPByWisdom, regenerationInterval);
}

// Função para regenerar HP com base na sabedoria
function regenerateHPByWisdom() {
    // Quantidade de HP regenerado é igual ao valor da constituição do jogador dividido por 3
    const hpRegenerated = Math.ceil(player.constitution / 3);

    // Verifica se o jogador está vivo e não alcançou o máximo de HP
    if (player.currentHp > 0 && player.currentHp < player.maxHp) {
        // Adiciona o HP regenerado, limitando ao máximo de HP
        player.currentHp = Math.min(player.maxHp, player.currentHp + hpRegenerated);
        updateGameInfo(); // Atualiza as informações do jogo após a regeneração
    }
}

// Função para iniciar o temporizador de aumento de XP passivo com base na inteligência
function startXpGainTimer() {

    // Calcula o intervalo de aumento de XP passivo baseado na inteligência do jogador
    const xpGainInterval = 50000 / player.intelligence; // Intervalo em milissegundos
    setInterval(() => {
        if (player.currentHp > 0) { // Verifica se o jogador está vivo
            gainXpByIntelligence();
        }
    }, xpGainInterval);

}
function startdebufftimer() {
    // Define a frequência do intervalo para 1 segundo (1000 ms)
    const interval = 1000;
    let hasLoggedDeath = false; // Variável de controle para rastrear se a mensagem de morte já foi enviada

    setInterval(() => {
        // Recalcula o dano de debuff a cada segundo, arredondado para baixo
        const debuffDamage = Math.floor(player.level/3);

        if (player.currentHp <= 0) {
            player.currentHp = 0; // Certifica-se de que o HP não fique negativo
            updateGameInfo(); // Atualiza as informações do jogo antes de exibir a mensagem
            if (!hasLoggedDeath) {
                playDeadSound();
                logMessage(`${player.name} morreu de fome!`);
                hasLoggedDeath = true; // Define a variável de controle para impedir logs repetidos
            }
            // Aqui você pode adicionar lógica adicional, como reiniciar o jogo ou outra ação
        } else {
            player.currentHp -= debuffDamage; // Aplica o dano de debuff
            if (player.currentHp < 0) {
                player.currentHp = 0; // Certifica-se de que o HP não fique negativo
            }
            updateGameInfo(); // Atualiza as informações do jogo
            
        }
    }, interval);
}

// Função para aumentar XP passivamente com base na inteligência
function gainXpByIntelligence() {
    if (player.currentHp <= 0) return; // Se o jogador está morto, não ganha XP

    // Calcula um valor aleatório de um dado de 6 faces
    const xpDice = Math.ceil(Math.random() * 6);

    // Calcula o XP ganho com base na inteligência ajustada
    const xpGained = Math.ceil(player.intelligence + xpDice);

    // Adiciona o XP ganho ao jogador
    player.xp += xpGained;
    if (player.xp >= player.xpNeeded) {
        levelUp();
    }
    updateGameInfo(); // Atualiza as informações do jogo após o aumento de XP
}

//randomizar dados
  function getRandomAbilityScore() {
  let diceValues = [];
  
  // Simula o lançamento de 4 dados de 6 lados
  for (let i = 0; i < 4; i++) {
    diceValues.push(Math.floor(Math.random() * 6) + 1);
  }
  
  // Ordena os valores do maior para o menor
  diceValues.sort((a, b) => b - a);
  
  // Soma os três maiores valores
  let sum = diceValues[0] + diceValues[1] + diceValues[2];
  
  return sum ;
}

//atributos atualizar com o dados
function rollDice() {
    if (!player.diceRolled) {
        player.strength = rollAttribute();
        player.constitution = rollAttribute();
        player.dexterity = rollAttribute();
        player.intelligence = rollAttribute();
        player.wisdom = rollAttribute();
        player.charisma = rollAttribute();

        document.getElementById('strength').value = player.strength;
        document.getElementById('constitution').value = player.constitution;
        document.getElementById('dexterity').value = player.dexterity;
        document.getElementById('intelligence').value = player.intelligence;
        document.getElementById('wisdom').value = player.wisdom;
        document.getElementById('charisma').value = player.charisma;

        document.getElementById('strength').readOnly = true;
        document.getElementById('constitution').readOnly = true;
        document.getElementById('dexterity').readOnly = true;
        document.getElementById('intelligence').readOnly = true;
        document.getElementById('wisdom').readOnly = true;
        document.getElementById('charisma').readOnly = true;

        player.diceRolled = true;
    } else {
        alert('Você já rolou os dados uma vez.');
    }
}
//rolar para atrubutos
function rollAttribute() {
    let diceValues = [];
    for (let i = 0; i < 4; i++) {
        diceValues.push(Math.floor(Math.random() * 6) + 1);
    }
    diceValues.sort((a, b) => b - a);
    return diceValues[0] + diceValues[1] + diceValues[2];
}
  // Função para atualizar os atributos na tela
  function updateAttributes() {
    document.getElementById('strength').value = player.strength;
    document.getElementById('constitution').value = player.constitution;
    document.getElementById('dexterity').value = player.dexterity;
    document.getElementById('intelligence').value = player.intelligence;
    document.getElementById('wisdom').value = player.wisdom;
    document.getElementById('charisma').value = player.charisma;
  } 

// Função para atualizar as informações do jogo na tela
function updateGameInfo() {
    document.getElementById('hpText').textContent = `${player.currentHp} / ${player.maxHp}`;
    document.getElementById('hpBar').style.width = `${(player.currentHp / player.maxHp) * 100}%`;
    document.getElementById('xpText').textContent = `${player.xp} / ${player.xpNeeded}`;
    document.getElementById('xpBar').style.width = `${(player.xp / player.xpNeeded) * 100}%`;
    document.getElementById('goldText').innerHTML = `<span>${player.gold}</span>`;
    document.getElementById('levelText').textContent = `${player.level}`;
}

// Define os monstros disponíveis por nível
player.monstersPerLevel = {
    1: [{ name: 'Sapo Briguento', damage:3 }, { name: 'Rato Selvagem', damage: 2}],
    2: [{ name: 'Bode Violento', damage: 5 }, { name: 'Macaco Ligeiro', damage: 3 }],
    3: [{ name: 'Rinoceronte Covarde', damage: 7}, { name: 'Gato do Mato', damage: 6 }],
    4: [{ name: 'Lobo Veloz', damage: 9 }, { name: 'Urso faminto', damage: 9 },
    { name: 'Dragão Papagaio', damage: 11 }, { name: 'Goblin Astuto', damage: 9 }],
    5: [{ name: 'Esqueleto sem dente', damage: 13 }, { name: 'Zumbi fedorento', damage: 12 }],
    6: [{ name: 'Troll Açogueiro', damage: 15 }, { name: 'Orc Voodoo', damage: 15 }],
    7: [{ name: 'Elemental de Fogo', damage: 17 }, { name: 'Elemental da Luz', damage: 17 },
     { name: 'Elemental das Trevas', damage: 17 }, { name: 'Elemental da Terra', damage: 17 }, 
     { name: 'Elemental da Água', damage: 17 }],
    8: [{ name: 'Tigre Feroz', damage: 21 }, { name: 'Panda Bêbado', damage: 19 }],
    9: [{ name: 'Camaleão Invisível', damage: 23 }, { name: 'Corvo Sombrio', damage: 22 }],
    10: [{ name: 'Grifo', damage: 25 }, { name: 'Bruxa Macabra', damage: 26 }],
    11: [{ name: 'Serpente do Lago', damage: 28 }, { name: 'Orc Raivoso', damage: 29 }],
    12: [{ name: 'Cerberus', damage: 30 }, { name: 'Ciclope', damage: 31 }],
    13: [{ name: 'Hidra', damage: 33 }, { name: 'Espectro', damage: 30 }],
    14: [{ name: 'Dragão Adulto', damage: 42 }, { name: 'Lich', damage: 35 }],
    15: [{ name: 'Bárdo e Paladino', damage: 50 }, { name: 'Bárbaro e Feiticeiro', damage: 50 },
         { name: 'Ladino e Mago', damage: 50 }, { name: 'Patrulheiro e Bruxo', damage: 50 }, 
         { name: 'Druida e Monge', damage: 50 }, { name: 'Guerreiro e Clérigo', damage: 50 }], 
    17: [{ name: 'Centauro', damage: 70 }, { name: 'Golem', damage: 60 }],
    18: [{ name: 'Harpia', damage: 80 }, { name: 'Gigante', damage: 75 }],
    19: [{ name: 'Nefilim', damage: 90 }, { name: 'Minotauro', damage: 85 }],
    20: [{ name: 'Kraken', damage: 100 }, { name: 'Dragão Milenar', damage: 100 }],
    21: [{ name: 'Mestre dos Elementos', damage: 120 }, { name: 'Necromante', damage: 130 }],
    22: [{ name: 'Espirito Arcano', damage: 150 }, { name: 'Paladino Negro', damage: 180 }],
    23: [{ name: 'Fada Etérea', damage: 200 }, { name: 'Mantícora', damage: 250 }],
    24: [{ name: 'Deus', damage: 500 }, { name: 'Avallon', damage: 300 }]    
};

//encontros menssagem
  function logMessage(message) {
  const encounterLog = document.getElementById('encounterLog');
  const p = document.createElement('p');
  p.textContent = message;
  encounterLog.appendChild(p);

  // Rola o log para a parte inferior após adicionar a mensagem
  encounterLog.scrollTop = encounterLog.scrollHeight;
}

function farmMonsters() {

    // Verifica se o jogador já está morto
    if (player.currentHp <= 0) {
        logMessage(`${player.name} você morreu, Comece outro jogo.`);
        return;
    }
    const currentLevel = player.level;
    let availableMonsters = [];

    // Reúne todos os monstros de níveis menores ou iguais ao nível atual do jogador
    for (let level = 1; level <= currentLevel; level++) {
        if (player.monstersPerLevel[level]) {
            availableMonsters = availableMonsters.concat(player.monstersPerLevel[level]);
        }
    }

    if (availableMonsters.length === 0) {
        logMessage('Nenhum monstro disponível para este nível.');
        return;
    }

    const randomMonsterIndex = Math.floor(Math.random() * availableMonsters.length);
    const monster = availableMonsters[randomMonsterIndex];
    const monstersDefeated = Math.floor(Math.random() * 3) + 1; // De 1 a 3 monstros
    
    const monsterDamage = monster.damage;
    const randomMonsterDamage = Math.floor(Math.random() * monsterDamage) + 1; // Dano aleatório entre 1 e monsterDamage

    // Calcula o ganho de ouro baseado no número de monstros e no dano do monstro
    const baseGoldEarned = monstersDefeated * 5;
    const randomGoldBonus = Math.floor(Math.random() * randomMonsterDamage) + 1; // Bônus de ouro aleatório entre 1 e randomMonsterDamage
    const totalGoldEarned = baseGoldEarned + randomGoldBonus + player.charisma;

    const monsterXp = monster.damage;
    const xpEarned = (5+player.level) * monsterXp; // 20 XP por monstro derrotado

    // Calcula a chance de esquiva baseada na destreza do jogador
    const dodgeChance = player.dexterity;
    const didDodge = Math.random() * 100 < dodgeChance;

    // Calcula o dano base
    let damageTaken = Math.floor((Math.random() * 4) + 1) * monsterDamage + monstersDefeated*5;

    // Reduz o dano com base na força do jogador
    const strengthReduction = Math.ceil(player.strength/5);
    damageTaken -= strengthReduction;

    // Calcula o bloqueio de dano baseado na força do jogador e no nível
    const armorReduction = Math.floor((player.strength / 200) * damageTaken);
    damageTaken -= armorReduction;

    // Certifica-se de que o dano nunca seja negativo
    damageTaken = Math.max(damageTaken, 0);

    // Aplica o dano no HP do jogador
    player.currentHp -= damageTaken;

    if (player.currentHp <= 0) {
        player.currentHp = 0; // Certifica-se de que o HP não fique negativo
        updateGameInfo(); // Atualiza as informações do jogo antes de exibir a mensagem
        playDeadSound();
        logMessage(`${player.name} recebeu ${damageTaken} de dano de ${monster.name} e morreu!`);
        // Aqui você pode adicionar lógica adicional, como reiniciar o jogo ou outra ação
    } else {
        // Adiciona um valor aleatório de um dado de 6 faces (d6) à inteligência do jogador
        const intelligenceWithDice = player.intelligence + Math.floor(Math.random() * 6) + 1;
        
        // Calcular XP adicional baseado na inteligência ajustada
        const xpBonus = Math.floor(xpEarned * (intelligenceWithDice / 40));
        const totalXpEarned = xpEarned + xpBonus;

        player.gold += totalGoldEarned;
        if (didDodge) {
            // Escolher aleatoriamente entre três mensagens
            const messageType = Math.floor(Math.random() * 3) + 1;
            if (messageType === 1) {
                player.xp += totalXpEarned;
                logMessage(`${player.name} esquivou do ataque de ${monster.name} e ganhou ${totalXpEarned} XP e ${totalGoldEarned} ouro.`);
            } else if (messageType === 2) {
                player.xp += totalXpEarned;
                logMessage(`${player.name} atacou furtivamente ${monster.name} e ganhou ${totalXpEarned} XP e ${totalGoldEarned} ouro.`);
            } else {
                logMessage(`${player.name} roubou furtivamente ${totalGoldEarned} de ouro sem ser notado.`);
            }
        } else {
            player.xp += totalXpEarned;
            logMessage(`${player.name} derrotou ${monster.name} e ganhou ${totalXpEarned} XP e ${totalGoldEarned} ouro. Dano recebido: ${damageTaken}.`);
        }
    
        if (player.xp >= player.xpNeeded) {
            levelUp();
        }
        updateGameInfo();
        playFarmSound();
    }
}
//função usar potion
function usePotion() {
    // Verifica se o jogador está vivo antes de permitir usar a Comida
    if (player.currentHp <= 0) {
        logMessage(`Comece o jogo!`);
        return; // Sai da função sem fazer mais nada
    }

    const potionHealAmount = 5*player.wisdom; // Define a quantidade de HP que a Comida irá curar

    if (player.gold >= player.potionCost) {
        // Verifica se o jogador tem ouro suficiente para comprar a Comida
        if (player.currentHp + potionHealAmount <= player.maxHp) {
            // Se a cura da Comida não exceder o máximo de HP, adiciona a quantidade de cura
            player.currentHp += potionHealAmount;
        } else {
            // Se a cura da Comida exceder o máximo de HP, apenas define para o máximo
            player.currentHp = player.maxHp;
        }

        // Subtrai o custo da Comida do ouro do jogador
        player.gold -= player.potionCost;

        // Atualiza as informações do jogo na tela
        updateGameInfo();
        playPotionSound();
        // Exibe mensagem de log para o jogador
        logMessage(`${player.name} comeu e restaurou ${potionHealAmount} HP.`);
    } else {
        // Se o jogador não tiver ouro suficiente, exibe mensagem de log informando
        logMessage(`${player.name} não tem ouro suficiente para comprar uma comida.`);
    }
}
function updatePotionButton() {
    document.querySelector('button[onclick="usePotion()"]').textContent = `Comida - ${player.potionCost} Ouro`;
}
// Mensagens personalizadas para cada atributo
const strengthMessages = [
    "Você me bateu? Uma briga de rua aumentou sua Força.",
    "Resgatar um gato dos destroços de uma casa aumetou sua Força.",
    "Um guerreiro lhe desafiou você está mais Forte.",
    "Após fazer musculação, sua Força aumentou.",
    "Uma luta de punhos aumentou sua Força.",
    "Carregar as compras da vovó aumentou sua Força.",
    "O Ferreiro ajustou seu equipamento, sua Força aumentou",
    "Você quebrou uma pedra com as próprias mãos, sua Força aumentou.",
    "Treinar artes marciais aumentou sua Força.",
    "Trabalhar edifica o homem, sua Força aumentou."
];

const constitutionMessages = [
    "Treinar no Dojo aumentou sua Constituição.",
    "Uma dieta saudável aumentou sua Constituição.",
    "Você sobreviveu a o treino de seu mestre, sua Constituição aumentou.",
    "Escalar montanhas aumentou sua Constituição.",
    "Enfrentar uma tempestade fortaleceu sua Constituição.",
    "Uma jornada por terrenos difíceis aumentou sua Constituição.",
    "Nadar em águas geladas aumentou sua Constituição.",
    "Você passou uma noite em vigília, sua Constituição aumentou.",
    "Treinar em alta altitude aumentou sua Constituição.",
    "Você se recuperou de uma doença, sua Constituição aumentou."
];

const dexterityMessages = [
    "Uma fuga desenfreada aumentou sua Destreza.",
    "Praticar acrobacias aumentou sua Destreza.",
    "Você treinou com um mestre ladino, sua Destreza aumentou.",
    "Desviar de obstáculos aumentou sua Destreza.",
    "Você dançou elegantemente, sua Destreza aumentou.",
    "Praticar tiro ao alvo aumentou sua Destreza.",
    "Uma corrida pelos telhados aumentou sua Destreza.",
    "Participar de uma competição de agilidade aumentou sua Destreza.",
    "O ferreiro lhe vendeu um equipamento, sua Destreza aumentou.",
    "Treinar movimentos rápidos com a espada aumentou sua Destreza"
];

const intelligenceMessages = [
    "Você descobriu algo espionando sua Inteligência aumentou.",
    "Ler um livro antigo aumentou sua Inteligência.",
    "Um mago lhe ensinou um novo truque, sua Inteligência aumentou.",
    "Resolver um enigma complexo aumentou sua Inteligência.",
    "Estudar pergaminhos antigos aumentou sua Inteligência.",
    "Você participou de um debate acadêmico, sua Inteligência aumentou.",
    "Passar horas na biblioteca aumentou sua Inteligência.",
    "Desenvolver uma fórmula mágica aumentou sua Inteligência.",
    "Aprender um novo idioma aumentou sua Inteligência.",
    "Explorar ruínas antigas aumentou sua Inteligência."
];

const wisdomMessages = [
    "Você pensou antes de agir, sua Sabedoria aumentou.",
    "Refletir sobre uma decisão importante aumentou sua Sabedoria.",
    "Meditar em um templo antigo aumentou sua Sabedoria.",
    "Ouvir conselhos de um ancião aumentou sua Sabedoria.",
    "Você passou um tempo em contemplação profunda, sua Sabedoria aumentou.",
    "O Ferreiro afiou suas lâminas, sua Sabedoria aumentou",
    "Estudar filosofia antiga aumentou sua Sabedoria.",
    "Consultar oráculos antigos aumentou sua Sabedoria.",
    "Praticar técnicas de meditação aumentou sua Sabedoria.",
    "Você aprendeu com as experiências de vida, sua Sabedoria aumentou."
];

const charismaMessages = [
    "Ganhar uma discussão aumentou seu Carisma.",
    "Conversar com as pessoas aumentou seu Carisma.",
    "Você encantou uma multidão, seu Carisma aumentou.",
    "Ajudar um necessitado aumentou seu Carisma.",
    "Cantar na rua aumentou seu Carisma.",
    "Usar uma joia roubada aumentou seu Carisma.",
    "Fazer amizades na taberna aumentou seu Carisma.",
    "Você ensinou seu aprendiz seu Carisma aumentou.",
    "Tocar Violão ao ar livre aumentou seu Carisma.",
    "Você está elegante seu Carisma aumentou."
];
// Função para obter uma mensagem aleatória
function getRandomMessage(messagesArray) {
    const randomIndex = Math.floor(Math.random() * messagesArray.length);
    return messagesArray[randomIndex];
}
// Função usar Taberna
function useTaberna() {
    // Verifica se o jogador está vivo antes de permitir usar a taberna
    if (player.currentHp <= 0) {
        logMessage(`Comece o jogo!`);
        return; // Sai da função sem fazer mais nada
    }

    if (player.gold >= player.tabernaCost) {
        // Lista de atributos
        let attributes = ['strength', 'constitution', 'dexterity', 'intelligence', 'wisdom', 'charisma'];

        // Seleciona um atributo aleatório
        let randomAttribute = attributes[Math.floor(Math.random() * attributes.length)];
        
        // Aumenta o atributo selecionado em 2
        player[randomAttribute] += 2;

        // Subtrai o custo da taberna do ouro do jogador
        player.gold -= player.tabernaCost;

        // Atualiza as informações do jogo na tela
        updateGameInfo();
        updateAttributes();

        // Exibe mensagem de log para o jogador com a mensagem personalizada
        let attributeMessages;
        switch (randomAttribute) {
            case 'strength':
                attributeMessages = strengthMessages;
                break;
            case 'constitution':
                attributeMessages = constitutionMessages;
                break;
            case 'dexterity':
                attributeMessages = dexterityMessages;
                break;
            case 'intelligence':
                attributeMessages = intelligenceMessages;
                break;
            case 'wisdom':
                attributeMessages = wisdomMessages;
                break;
            case 'charisma':
                attributeMessages = charismaMessages;
                break;
        }
        logMessage(getRandomMessage(attributeMessages));
        playTabernaSound();

    } else {
        // Se o jogador não tiver ouro suficiente, exibe mensagem de log informando
        logMessage(`${player.name} não tem ouro suficiente para usar a taberna.`);
    }
}

// Função para atualizar o botão da Taberna Modificado para Evento
function updateTabernaButton() {
    document.querySelector('button[onclick="useTaberna()"]').textContent = `Evento - ${player.tabernaCost} Ouro`;
}

//função upar
function levelUp() {
    player.level++;
    player.xp -= player.xpNeeded;
    player.xpNeeded = Math.floor((player.xpNeeded + 82) * 1.22);
    player.maxHp += Math.floor((player.constitution / 2) + (Math.random() * 12) + 5);
    player.currentHp = player.maxHp;
    
// Aumenta os atributos com base na classe do jogador
switch (player.class) {

//Carisma  
    case 'bardo':
        player.charisma += 1; 
        break;

    case 'feiticeiro':
        player.charisma += 1; 
        break;

//Destreza
    case 'patrulheiro':
        player.dexterity += 1; 
        break;
 
    case 'ladino':
        player.dexterity += 1; 
        break;

//Inteligência

    case 'mago':
        player.intelligence += 1; 
        break;

    case 'clerigo':
        player.intelligence += 1; 
        break;

//Sabedoria
    case 'druida':
        player.wisdom += 1; 
        break;

    case 'monge':
        player.wisdom += 1; 
        break;

//Força
    case 'guerreiro':
        player.strength += 1;
        break;

    case 'barbaro':
        player.strength += 1; 
        break;

//Constituição
    case 'bruxo':
        player.constitution += 1; 
        break;

    case 'paladino':
        player.constitution += 1; 
        break;

    default:
        console.error('Classe desconhecida:', player.class);
}

    // Aumenta os atributos com base no nível
    let attributes = ['strength', 'constitution', 'dexterity', 'intelligence', 'wisdom', 'charisma'];
    for (let i = 0; i < 2; i++) {
    let randomAttribute = attributes[Math.floor(Math.random() * attributes.length)];
    player[randomAttribute] += 1;
}
    // Recalcula o custo da Comida
    player.potionCost = calculatePotionCost();
    updatePotionButton(); // Atualiza o texto do botão de Comida
    updateTabernaButton();
    updateAttributes(); // Atualiza os campos do formulário com os novos valores de player

    updateGameInfo();
    playLevelUpSound();
    logMessage(`${player.name} subiu para o nível ${player.level}.`);
        // Verifica se o jogador atingiu o nível 3 e registra a mensagem
        if (player.level === 3) {
        logMessage(`${player.name} O Debuff de fome aplicado, sofrendo dano por segundo!`);
    }
}

  // Funções para reproduzir som
  function playLevelUpSound() {
    const levelUpSound = document.getElementById('levelUpSound');
    levelUpSound.currentTime = 0;
    levelUpSound.play();
  }
  function playPotionSound() {
    const potionSound = document.getElementById('potionSound');
    potionSound.currentTime = 0;
    potionSound.play();
  }
  function playDeadSound() {
    const deadSound = document.getElementById('deadSound');
    deadSound.currentTime = 0;
    deadSound.play();
  }
</script>

</body>
</html>